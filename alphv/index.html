<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>ALPHV ransomware - d01a</title><meta name="Description" content="ALPHV ransomware analysis"><meta property="og:title" content="ALPHV ransomware" />
<meta property="og:description" content="ALPHV ransomware analysis" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://d01a.github.io/alphv/" /><meta property="og:image" content="https://d01a.github.io/alphv/featured-image.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-12T11:04:49+08:00" />
<meta property="article:modified_time" content="2024-05-30T03:27:54+03:00" /><meta property="og:site_name" content="d01a" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://d01a.github.io/alphv/featured-image.jpg"/>
<meta name="twitter:title" content="ALPHV ransomware"/>
<meta name="twitter:description" content="ALPHV ransomware analysis"/>
<meta name="application-name" content="d01a">
<meta name="apple-mobile-web-app-title" content="d01a"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/Luffy.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://d01a.github.io/alphv/" /><link rel="prev" href="https://d01a.github.io/redline/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ALPHV ransomware",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/d01a.github.io\/alphv\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/d01a.github.io\/alphv\/featured-image.jpg",
                            "width":  3600 ,
                            "height":  2400 
                        }],"genre": "posts","keywords": "Malware Analysis, Reverse Engineering","wordcount":  3757 ,
        "url": "https:\/\/d01a.github.io\/alphv\/","datePublished": "2023-09-12T11:04:49+08:00","dateModified": "2024-05-30T03:27:54+03:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Mohamed Adel","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/d01a.github.io\/images\/avatar.png",
                    "width":  715 ,
                    "height":  715 
                }},"author": {
                "@type": "Person",
                "name": "Mohamed Adel"
            },"description": "ALPHV ransomware analysis"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="d01a"><span class="header-title-pre"><i class='fa-solid fa-skull' aria-hidden='true'></i></span>d01a</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/d01a" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="d01a"><span class="header-title-pre"><i class='fa-solid fa-skull' aria-hidden='true'></i></span>d01a</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/d01a" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ALPHV ransomware</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://d01a.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Mohamed Adel</a></span>&nbsp;<span class="post-category">included in <a href="/categories/malware-analysis/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Malware Analysis</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-09-12">2023-09-12</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;3757 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;18 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/featured-image.jpg"
        data-srcset="/alphv/featured-image.jpg, /alphv/featured-image.jpg 1.5x, /alphv/featured-image.jpg 2x"
        data-sizes="auto"
        alt="/alphv/featured-image.jpg"
        title="ALPHV ransomware analysis" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#analysis">Analysis</a>
      <ul>
        <li><a href="#identifying-the-sample">Identifying the sample.</a></li>
        <li><a href="#ransomware-running-options">Ransomware running options.</a></li>
        <li><a href="#command-line-and-configuration-parsing">Command Line and Configuration Parsing</a></li>
        <li><a href="#debugging-issues">Debugging issues</a></li>
        <li><a href="#preparing-the-environment">Preparing the environment</a></li>
        <li><a href="#gather-victim-info">Gather victim info.</a></li>
        <li><a href="#privilege-escalation-uac-bypass">Privilege Escalation (UAC Bypass)</a></li>
        <li><a href="#more-preparation-elevated-child-process-to-continue">More preparation: elevated Child process to continue</a></li>
        <li><a href="#delete-shadow-copies">Delete Shadow Copies</a></li>
        <li><a href="#delete-event-logs">Delete Event logs.</a></li>
        <li><a href="#kill-targeted-services--processes">Kill Targeted Services &amp; Processes</a></li>
        <li><a href="#encryption-mechanism">Encryption Mechanism</a></li>
      </ul>
    </li>
    <li><a href="#config-extractor">Config Extractor</a></li>
    <li><a href="#yara">YARA</a></li>
    <li><a href="#iocs">IOCs</a></li>
    <li><a href="#mitre-attck">MITRE ATT&amp;CK</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="introduction">Introduction</h2>
<p>ALPHV/Blackcat is a ransomware family that uses Ransomware-as-a-service (RaaS) business model. The ransomware is written in Rust Programming language. It is highly configurable using embedded configurations or provided as command line arguments. The malware family has Windows, Linux and ESXi versions. The malware uses AES or ChaCha20 to encrypt the files and delete the volume shadow copies to decrease the possibility of any data survival. It also kills predefined set of services and Processes related to Anti-malware products, Virtualization software and other business-related and backup software.  The following graph represents the attack flow of the ransomware.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled.png"
        data-srcset="/alphv/img/Untitled.png, /alphv/img/Untitled.png 1.5x, /alphv/img/Untitled.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled.png"
        title="Untitled" width="12549" height="2967" /></p>
<h2 id="analysis">Analysis</h2>
<h3 id="identifying-the-sample">Identifying the sample.</h3>
<p>The sample was identified by <code>Detect It Easy</code> to be compiled with <code>mingw</code> , this should be some native application. But when I looked at the strings, I knew that it was <code>Rust</code> compiled malware.</p>
<p>Opening the sample in IDA will take some time to do the analysis. Rust binaries are not easy to reverse, especially with stripped -release- binaries. It is statically linked so it is expected to have so many functions and most of them are library and crate functions. Another issue is the strings (all the type system actually), the strings are stored in a structure containing a pointer to the string, length, and capacity.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">String</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="n">DWORD</span> <span class="n">length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">DWORD</span> <span class="n">buff</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">DWORD</span> <span class="n">capacity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The string itself is not null-terminated string so the strings will be mixed. one way to identify the right string is to change the target region to raw data and select the start of the string to the next <code>Xref</code> , this is the termination of the string (Not working all the time).</p>
<p>There are a lot of strange things related to types in rust but will be explained as we move on (if I had to). Another thing to keep in mind is that there will be a lot of function calls related to error checking and memory safety related to Rust so, I will try to avoid wasting too much time to recognize them.</p>
<p>Now we could start, First The main function should be found. The main function will not be clear as in native binaries for example. The <code>start</code> or <code>main</code> function identified by IDA has a lot of unrelated functions to do the initializations and the checks that Rust compiler did (like CRT initializations). The main function is passed to another function, called <code>lang_start</code> .</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%201.png"
        data-srcset="/alphv/img/Untitled%201.png, /alphv/img/Untitled%201.png 1.5x, /alphv/img/Untitled%201.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%201.png"
        title="Untitled" width="337" height="93" /></p>
<p>Originally, the function’s addresses are <code>user_main: 0x0047B1F0</code> and <code>lang_start: 0x0049BD80</code>. <code>lang_start</code> just call the user main function stored in <code>ecx</code> . <code>user_main</code> also just transfers the execution to <code>sub_48F3C0</code>.</p>
<p>Before going into the assembly to see what this does, I looked at strings for a while and got some interesting findings.</p>
<ul>
<li><code>/rustc/532d2b14c05f9bc20b2d27cbb5f4550d28343a36\library\core\src\</code> that string contains the commit hash for the rust version. The rust version used is <code>rustc 1.59.0</code>. it was out in 2021 (nighty version) this could give us a hint about the period of the malware operation.</li>
<li>Configuration of the ransomware.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%202.png"
        data-srcset="/alphv/img/Untitled%202.png, /alphv/img/Untitled%202.png 1.5x, /alphv/img/Untitled%202.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%202.png"
        title="Untitled" width="529" height="575" /></p>
<p>The important thing is the <code>extension: kh1ftzx</code> field. A quick google search reveals the ransomware family is <code>ALPHV/BlackCat</code> Ransomware.</p>
<h3 id="ransomware-running-options">Ransomware running options.</h3>
<p>Trying to run the sample.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%203.png"
        data-srcset="/alphv/img/Untitled%203.png, /alphv/img/Untitled%203.png 1.5x, /alphv/img/Untitled%203.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%203.png"
        title="Untitled" width="801" height="337" /></p>
<p>It has a sub-command <code>--access-token</code> which does nothing. Running the sample with any random token will work.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%204.png"
        data-srcset="/alphv/img/Untitled%204.png, /alphv/img/Untitled%204.png 1.5x, /alphv/img/Untitled%204.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%204.png"
        title="Untitled" width="1046" height="305" /></p>
<h3 id="command-line-and-configuration-parsing">Command Line and Configuration Parsing</h3>
<p>Back to <code>user_main</code> , the function calls <code>sub_47DF80</code> which calls <code>sub_5DFA10</code>. <code>sub_5DFA10</code> is used to get the Command line used, using <code>GetCommandLineW</code>.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%205.png"
        data-srcset="/alphv/img/Untitled%205.png, /alphv/img/Untitled%205.png 1.5x, /alphv/img/Untitled%205.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%205.png"
        title="Untitled" width="692" height="317" /></p>
<p>Then it parses the command line string. it extracts the subcommand passed, <code>--access-token</code> was tested and seems like it did nothing with it. Out of this function, back to the previous one <code>sub_47DF80</code>, it continues to parse the Command line checking for <code>-h</code> or <code>--help</code> presence to print the help menu. The help menu is displayed by using the console of the currently running process so in case of using a debugger, <code>AttachConsole</code> argument <code>dwProcessId</code> should be edited to another console process (CMD).</p>
<p>It then loads the hardcoded configurations (Config extractor code at the end of the report) as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;config_id&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;public_key&#34;</span><span class="p">:</span> <span class="s2">&#34;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAq8kj5LQJngPsY7AhTaJsUXc5FrSGeKS5gw5PIqk2QPM9TY6+us8TRRzWZ7rGk1zns2klpzpRMUzLIqB8lpCkJjqkOUGfgqs+HN4VIOpoJgFY897xstJCxTc+8pYQEsSqClxJllscU0okkLSQqndIR2Gznlg3qfcwyncJAFBInyqM+L4kbwCQZ6x5HNiLe2lJn8RP2aDiMI+RS1uLYron2G7rxDTUQnxThMtgLAeko8ulaB3TpB0g4lmHCenkEZeBNs81986+MjHnv7KkiscZ7ZrezKjNaIxRs8BAcD9y+Q9QQxCvZMS01ITNXcgiItbA4dsGq1fPJ42yBkkiIodsEQIDAQAB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;extension&#34;</span><span class="p">:</span> <span class="s2">&#34;kh1ftzx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;note_file_name&#34;</span><span class="p">:</span> <span class="s2">&#34;RECOVER-${EXTENSION}-FILES.txt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;note_full_text&#34;</span><span class="p">:</span> <span class="s2">&#34;&gt;&gt; What happened?\n\nImportant files on your network was ENCRYPTED and now they have \&#34;${EXTENSION}\&#34; extension.\nIn order to recover your files you need to follow instructions below.\n\n&gt;&gt; Sensitive Data\n\nSensitive data on your system was DOWNLOADED.\nIf you DON&#39;T WANT your sensitive data to be PUBLISHED you have to act quickly.\n\nData includes:\n- Employees personal data, CVs, DL, SSN.\n- Complete network map including credentials for local and remote services.\n- Private financial information including: clients data, bills, budgets, annual reports, bank statements.\n- Manufacturing documents including: datagrams, schemas, drawings in solidworks format\n- And more...\n\n&gt;&gt; CAUTION\n\nDO NOT MODIFY ENCRYPTED FILES YOURSELF.\nDO NOT USE THIRD PARTY SOFTWARE TO RESTORE YOUR DATA.\nYOU MAY DAMAGE YOUR FILES, IT WILL RESULT IN PERMANENT DATA LOSS.\n\n&gt;&gt; What should I do next?\n\nFollow these simple steps to get everything back to normal:\n1) Download and install Tor Browser from: https://torproject.org/\n2) Navigate to: http://rfosusl6qdm4zhoqbqnjxaloprld2qz35u77h4aap46rhwkouejsooqd.onion/?access-key=${ACCESS_KEY}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;note_short_text&#34;</span><span class="p">:</span> <span class="s2">&#34;Important files on your network was DOWNLOADED and ENCRYPTED.\nSee \&#34;${NOTE_FILE_NAME}\&#34; file to get further instructions.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;default_file_mode&#34;</span><span class="p">:</span> <span class="s2">&#34;Auto&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;default_file_cipher&#34;</span><span class="p">:</span> <span class="s2">&#34;Best&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;credentials&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;kill_services&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;mepocs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;memtas&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;veeam&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;svc$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;backup&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;vss&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;msexchange&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sql$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;mysql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;mysql$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sophos&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;MSExchange&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;MSExchange$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;WSBExchange&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;PDVFSService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;BackupExecVSSProvider&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;BackupExecAgentAccelerator&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;BackupExecAgentBrowser&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;BackupExecDiveciMediaService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;BackupExecJobEngine&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;BackupExecManagementService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;BackupExecRPCService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;GxBlr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;GxVss&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;GxClMgrS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;GxCVD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;GxCIMgr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;GXMMM&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;GxVssHWProv&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;GxFWD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;SAPService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;SAP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;SAP$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;SAPD$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;SAPHostControl&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;SAPHostExec&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;QBCFMonitorService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;QBDBMgrN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;QBIDPService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;AcronisAgent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;VeeamNFSSvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;VeeamDeploymentService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;VeeamTransportSvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;MVArmor&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;MVarmor64&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;VSNAPVSS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;AcrSch2Svc&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;kill_processes&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;agntsvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;dbeng50&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;dbsnmp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;encsvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;excel&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;firefox&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;infopath&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;isqlplussvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;msaccess&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;mspub&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;mydesktopqos&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;mydesktopservice&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;notepad&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ocautoupds&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ocomm&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ocssd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;onenote&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;oracle&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;outlook&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;powerpnt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sqbcoreservice&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;steam&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;synctime&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;tbirdconfig&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;thebat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;thunderbird&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;visio&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;winword&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;wordpad&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;xfssvccon&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;*sql*&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;bedbh&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;vxmon&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;benetns&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;bengien&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pvlsvr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;beserver&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;raw_agent_svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;vsnapvss&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;CagService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;QBIDPService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;QBDBMgrN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;QBCFMonitorService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;SAP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;TeamViewer_Service&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;TeamViewer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;tv_w32&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;tv_x64&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;CVMountd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;cvd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;cvfwd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;CVODS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;saphostexec&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;saposcol&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sapstartsrv&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;avagent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;avscc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DellSystemDetect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;EnterpriseClient&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;VeeamNFSSvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;VeeamTransportSvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;VeeamDeploymentSvc&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;exclude_directory_names&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;system volume information&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;intel&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;$windows.~ws&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;application data&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;$recycle.bin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;mozilla&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;$windows.~bt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;public&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;msocache&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;windows&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;default&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;all users&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;tor browser&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;programdata&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;boot&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;config.msi&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;google&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;perflogs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;appdata&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;windows.old&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;exclude_file_names&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;desktop.ini&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;autorun.inf&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ntldr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;bootsect.bak&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;thumbs.db&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;boot.ini&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ntuser.dat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;iconcache.db&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;bootfont.bin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ntuser.ini&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ntuser.dat.log&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;exclude_file_extensions&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;themepack&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;nls&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;diagpkg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;msi&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;lnk&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;exe&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;cab&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;scr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;bat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;drv&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;rtp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;msp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;prf&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;msc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ico&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;key&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ocx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;diagcab&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;diagcfg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pdb&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;wpx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;hlp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;icns&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;rom&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;dll&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;msstyles&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;mod&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ps1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ics&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;hta&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;bin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;cmd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ani&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;386&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;lock&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;cur&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;idx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sys&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;deskthemepack&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;shs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ldf&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;theme&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;mpa&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;nomedia&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;spl&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;cpl&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;adv&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;icl&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;msu&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;exclude_file_path_wildcard&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;enable_network_discovery&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;enable_self_propagation&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;enable_set_wallpaper&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;enable_esxi_vm_kill&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;enable_esxi_vm_snapshot_kill&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;strict_include_paths&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;esxi_vm_kill_exclude&#34;</span><span class="p">:</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The malware uses open-source library to parse the command line arguments, it is <code>clap</code> crate.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%206.png"
        data-srcset="/alphv/img/Untitled%206.png, /alphv/img/Untitled%206.png 1.5x, /alphv/img/Untitled%206.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%206.png"
        title="Untitled" width="1179" height="183" /></p>
<p>After long time of debugging, the function <code>sub_47DF80</code> is used to get the command line arguments and extract the configuration passed. And extract the default configurations that hardcoded in the binary.</p>
<h3 id="debugging-issues">Debugging issues</h3>
<p>The sample broke and didn’t continue in debugger even if the command line edited, but it works in usual CMD. So, to use the debugger we need something to delay execution to attach the debugger in early code. I patched the code and added a call to sleep function followed by INT 3 to instruction (Not shown in screenshot) to make it crash and put a breakpoint in any following instruction and NOP INT3 to continue :).</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%207.png"
        data-srcset="/alphv/img/Untitled%207.png, /alphv/img/Untitled%207.png 1.5x, /alphv/img/Untitled%207.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%207.png"
        title="Untitled" width="995" height="123" /></p>
<h3 id="preparing-the-environment">Preparing the environment</h3>
<p>The malware retrieves <code>MachineGuid</code> from the registry sub-key <code>SOFTWARE\\Microsoft\\Cryptography</code> by opening the sub-key and then retrieves the value <code>MachineGuid</code> using <code>RegQueryValueExW</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%208.png"
        data-srcset="/alphv/img/Untitled%208.png, /alphv/img/Untitled%208.png 1.5x, /alphv/img/Untitled%208.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%208.png"
        title="Untitled" width="1109" height="335" /></p>
<p>There is no such key in my machine, so it fails to read but anyway it continues.</p>
<p>The next step is to execute WMIC command <code>wmic csproduct get UUID</code> But first it should open CMD. It searches for <code>cmd.exe</code> in the current working directory.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%209.png"
        data-srcset="/alphv/img/Untitled%209.png, /alphv/img/Untitled%209.png 1.5x, /alphv/img/Untitled%209.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%209.png"
        title="Untitled" width="1041" height="202" /></p>
<p>If not found in the current directory, it searches for it in <code>system32</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2010.png"
        data-srcset="/alphv/img/Untitled%2010.png, /alphv/img/Untitled%2010.png 1.5x, /alphv/img/Untitled%2010.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2010.png"
        title="Untitled" width="951" height="184" /></p>
<p>After finding the target executable, the following command is executed.  The <code>UUID</code> will be used later to generate access key value to be used to access the malware website on the darknet.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;C:\Windows\system32\cmd.exe&#34; /c &#34;wmic csproduct get UUID&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>The malware then Get a handle to a virtual file <code>\\?\nul</code> , I’m not sure but this could be used to redirect any messages to no place.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2011.png"
        data-srcset="/alphv/img/Untitled%2011.png, /alphv/img/Untitled%2011.png 1.5x, /alphv/img/Untitled%2011.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2011.png"
        title="Untitled" width="797" height="167" /></p>
<p>Then, the malware creates a named pipe <code>\\\\.\\pipe\\rust_anonymous_pipe1.&lt;PID&gt;.&lt;RandomValue&gt;</code>  to be used in communication in standard OUT (-11)/ERR (-12).</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2012.png"
        data-srcset="/alphv/img/Untitled%2012.png, /alphv/img/Untitled%2012.png 1.5x, /alphv/img/Untitled%2012.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2012.png"
        title="Untitled" width="622" height="103" /></p>
<p>The pipe open mode is <code>PIPE_ACCESS_INBOUND|FILE_FLAG_OVERLAPPED|FILE_FLAG_FIRST_PIPE_INSTANCE</code> The pipe has access to read, write, and connect operations. and reject remote clients <strong>(PIPE_REJECT_REMOTE_CLIENTS).</strong>  All the handles to the created named pipes.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2013.png"
        data-srcset="/alphv/img/Untitled%2013.png, /alphv/img/Untitled%2013.png 1.5x, /alphv/img/Untitled%2013.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2013.png"
        title="Untitled" width="612" height="85" /></p>
<p>Finally, it is called <code>CreateProcessW</code> to create CMD process. The created process will be hidden as the flags passed are <code>CREATE_NO_WINDOW|CREATE_PROTECTED_PROCESS</code>.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2014.png"
        data-srcset="/alphv/img/Untitled%2014.png, /alphv/img/Untitled%2014.png 1.5x, /alphv/img/Untitled%2014.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2014.png"
        title="Untitled" width="733" height="144" /></p>
<p>To receive the return value, <code>WaitForMultipleObjects</code> is used to wait for a previously created events (2 events) then, it reads the output from the previously created pipe.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2015.png"
        data-srcset="/alphv/img/Untitled%2015.png, /alphv/img/Untitled%2015.png 1.5x, /alphv/img/Untitled%2015.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2015.png"
        title="Untitled" width="1227" height="363" /></p>
<h3 id="gather-victim-info">Gather victim info.</h3>
<p>The malware creates some other thread to execute another code section (function at address 0x005EFAA0).</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2016.png"
        data-srcset="/alphv/img/Untitled%2016.png, /alphv/img/Untitled%2016.png 1.5x, /alphv/img/Untitled%2016.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2016.png"
        title="Untitled" width="1035" height="237" /></p>
<p>It calls <code>GetSystemInfo</code> to obtain some information about the victim. (_SYSTEM_INFO struct in the memory dump).</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2017.png"
        data-srcset="/alphv/img/Untitled%2017.png, /alphv/img/Untitled%2017.png 1.5x, /alphv/img/Untitled%2017.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2017.png"
        title="Untitled" width="968" height="99" /></p>
<p>It Also Call <code>ntdll.ZwQueryInformationProcess</code> with <code>ProcessInformationClass=0x0</code> to get the PEB structure of the currently running process.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2018.png"
        data-srcset="/alphv/img/Untitled%2018.png, /alphv/img/Untitled%2018.png 1.5x, /alphv/img/Untitled%2018.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2018.png"
        title="Untitled" width="909" height="198" /></p>
<p>It then calls <code>ReadProcessMemory</code> again to read <code>LDR</code> Structure. Also, it gets uses the same function to get the full path to the currently running executable.</p>
<h3 id="privilege-escalation-uac-bypass">Privilege Escalation (UAC Bypass)</h3>
<p>The malware uses <a href="https://learn.microsoft.com/en-gb/windows/win32/com/the-com-elevation-moniker" target="_blank" rel="noopener noreffer ">COM moniker</a> to bypass UAC and elevate its privileges.</p>
<p>First it calls <code>CoInitializeEx</code> to initialize the COM library.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2019.png"
        data-srcset="/alphv/img/Untitled%2019.png, /alphv/img/Untitled%2019.png 1.5x, /alphv/img/Untitled%2019.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2019.png"
        title="Untitled" width="642" height="79" /></p>
<p>it then uses CLSID = <code>{3E5FC7F9-9A51-4367-9063-A120244FBEC7}</code> which is CMSTPLUA is a COM interface prone to UAC bypass; To call another function that calls <code>CoGetObject</code> .</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2020.png"
        data-srcset="/alphv/img/Untitled%2020.png, /alphv/img/Untitled%2020.png 1.5x, /alphv/img/Untitled%2020.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2020.png"
        title="Untitled" width="775" height="96" /></p>
<p>it makes the string <code>Elevation:Administrator!new:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}</code> to elevate the privileges and bypass UAC.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2021.png"
        data-srcset="/alphv/img/Untitled%2021.png, /alphv/img/Untitled%2021.png 1.5x, /alphv/img/Untitled%2021.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2021.png"
        title="Untitled" width="1185" height="133" /></p>
<p>After that, it uninitialized the COM object by calling <code>CoUninitialize</code> ****</p>
<p>According to <a href="https://news.sophos.com/en-us/2020/04/24/lockbit-ransomware-borrows-tricks-to-keep-up-with-revil-and-maze/" target="_blank" rel="noopener noreffer ">sophos&rsquo; lockbit 3 blog</a> this should left a trace in the registry Key <code>Software\Microsoft\Windows NT\CurrentVersion\ICM\Calibration</code></p>
<p>the following value.</p>
<p><code>C:\WINDOWS\SysWOW64\DllHost.exe /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}</code></p>
<p>But I couldn’t find it on my machine.</p>
<h3 id="more-preparation-elevated-child-process-to-continue">More preparation: elevated Child process to continue</h3>
<p>The malware spawns another elevated process that continues execution. After that, it adds a registry key using <code>reg add</code> command. And use the previously mentioned way of executing CMD. The registry key is used to edit the <code>MaxMpxCt</code> member to increase the maximum number of outstanding client requests.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2022.png"
        data-srcset="/alphv/img/Untitled%2022.png, /alphv/img/Untitled%2022.png 1.5x, /alphv/img/Untitled%2022.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2022.png"
        title="Untitled" width="461" height="148" /></p>
<p>the following command is executed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> &#34;C:\Windows\system32\cmd.exe&#34; /c &#34;reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters /v MaxMpxCt /d 65535 /t REG_DWORD /f
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the same (previous) screenshot we see a usage of <code>fsutil</code> utility in windows that can deal with the windows file system. The commands executed are :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">fsutil behavior set SymlinkEvaluation R2R:1
</span></span><span class="line"><span class="cl">fsutil behavior set SymlinkEvaluation R2L:1
</span></span></code></pre></td></tr></table>
</div>
</div><p>These commands will be executed to set symbolic links to enable:</p>
<ul>
<li>Remote to Remote Symbolic links</li>
<li>Remote to Local symbolic links</li>
</ul>
<p>Another command is executed to get the entries of the ARP table.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2023.png"
        data-srcset="/alphv/img/Untitled%2023.png, /alphv/img/Untitled%2023.png 1.5x, /alphv/img/Untitled%2023.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2023.png"
        title="Untitled" width="544" height="86" /></p>
<p>Then, it tries to reset IIS service by using <code>iisreset.exe /stop</code> .</p>
<h3 id="delete-shadow-copies">Delete Shadow Copies</h3>
<p>To make sure that all the data are deleted/Encrypted, The malware then deletes all the shadow copies using <code>vssadmin</code> utility. The following are the arguments to <code>CreateProcessW</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2024.png"
        data-srcset="/alphv/img/Untitled%2024.png, /alphv/img/Untitled%2024.png 1.5x, /alphv/img/Untitled%2024.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2024.png"
        title="Untitled" width="762" height="92" /></p>
<p>The command executed is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;C:\Windows\system32\cmd.exe&#34; /c &#34;vssadmin.exe Delete Shadows /all /quiet&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then, it uses <code>wmic</code> utility to delete the shadow copies again.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2025.png"
        data-srcset="/alphv/img/Untitled%2025.png, /alphv/img/Untitled%2025.png 1.5x, /alphv/img/Untitled%2025.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2025.png"
        title="Untitled" width="723" height="89" /></p>
<p>The command executed is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;C:\Windows\system32\cmd.exe&#34; /c &#34;wmic.exe Shadowcopy Delete&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Next, it modifies the Bootloader default to disable recovery mode using <code>bcdedit</code> utility. It runs two instances of the command line. The first was not complete so it returns an error message. The second is the following. And it runs successfully:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2026.png"
        data-srcset="/alphv/img/Untitled%2026.png, /alphv/img/Untitled%2026.png 1.5x, /alphv/img/Untitled%2026.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2026.png"
        title="Untitled" width="755" height="91" /></p>
<p>The command executed is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;C:\Windows\system32\cmd.exe&#34; /c &#34;bcdedit /set {default} recoveryenabled No&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="delete-event-logs">Delete Event logs.</h3>
<p>Then, it runs the following script:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="s2">&#34;C:\Windows\system32\cmd.exe&#34;</span> <span class="p">/</span><span class="n">c</span> <span class="s2">&#34;cmd.exe /c  for /F \&#34;</span><span class="n">tokens</span><span class="p">=*\</span><span class="s2">&#34; %1 in (&#39;wevtutil.exe el&#39;) DO wevtutil.exe cl \&#34;</span><span class="k">%</span><span class="n">1</span><span class="p">\</span><span class="s2">&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This script is used to clear the Event logs entries. It gets all the event logs using <code>wevtutil.exe el</code> and uses <code>wevtutil.exe cl</code> to clear them.</p>
<h3 id="kill-targeted-services--processes">Kill Targeted Services &amp; Processes</h3>
<p>Then it is called Global\SvcctrlStartEvent_A3752DX and <code>OpenScManagerW</code> ****according to google, this is used to duplicate windows services.  Then it uses <code>EnumServicesStatusExW</code> to list all the services and then kills the services specified in the <code>kill_services</code> in the configurations.  For every service, it runs a loop to compare against every entry in the saved <code>kill_services</code> . The targeted services to kill are:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl">   <span class="s">&#34;mepocs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;memtas&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;veeam&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;svc$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;backup&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;sql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;vss&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;msexchange&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;sql$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;mysql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;mysql$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;sophos&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;MSExchange&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;MSExchange$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;WSBExchange&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;PDVFSService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;BackupExecVSSProvider&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;BackupExecAgentAccelerator&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;BackupExecAgentBrowser&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;BackupExecDiveciMediaService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;BackupExecJobEngine&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;BackupExecManagementService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;BackupExecRPCService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;GxBlr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;GxVss&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;GxClMgrS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;GxCVD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;GxCIMgr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;GXMMM&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;GxVssHWProv&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;GxFWD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;SAPService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;SAP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;SAP$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;SAPD$&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;SAPHostControl&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;SAPHostExec&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;QBCFMonitorService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;QBDBMgrN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;QBIDPService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;AcronisAgent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;VeeamNFSSvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;VeeamDeploymentService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;VeeamTransportSvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;MVArmor&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;MVarmor64&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;VSNAPVSS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;AcrSch2Svc&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Same as <code>kill_services</code> , it searches for any running process that included in <code>kill_processes</code> . It gets a list of the currently running processes using <code>CreateToolhelp32Snapshot</code> and iterate through the snapshot using <code>Process32FirstW</code> and <code>Process32NextW</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2027.png"
        data-srcset="/alphv/img/Untitled%2027.png, /alphv/img/Untitled%2027.png 1.5x, /alphv/img/Untitled%2027.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2027.png"
        title="Untitled" width="668" height="517" /></p>
<p>The targeted Processes are:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl">	 <span class="s">&#34;agntsvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;dbeng50&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;dbsnmp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;encsvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;excel&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;firefox&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;infopath&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;isqlplussvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;msaccess&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;mspub&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;mydesktopqos&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;mydesktopservice&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;notepad&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;ocautoupds&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;ocomm&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;ocssd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;onenote&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;oracle&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;outlook&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;powerpnt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;sqbcoreservice&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;sql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;steam&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;synctime&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;tbirdconfig&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;thebat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;thunderbird&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;visio&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;winword&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;wordpad&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;xfssvccon&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;*sql*&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;bedbh&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;vxmon&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;benetns&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;bengien&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;pvlsvr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;beserver&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;raw_agent_svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;vsnapvss&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;CagService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;QBIDPService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;QBDBMgrN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;QBCFMonitorService&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;SAP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;TeamViewer_Service&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;TeamViewer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;tv_w32&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;tv_x64&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;CVMountd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;cvd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;cvfwd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;CVODS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;saphostexec&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;saposcol&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;sapstartsrv&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;avagent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;avscc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;DellSystemDetect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;EnterpriseClient&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;VeeamNFSSvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;VeeamTransportSvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;VeeamDeploymentSvc&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The malware lists all the available servers using <code>NetServerEnum</code> to display all the servers on the verbose screen. It Also retrieves the computer name using <code>GetComputerNameW</code> , it will be used in the verbose output.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2028.png"
        data-srcset="/alphv/img/Untitled%2028.png, /alphv/img/Untitled%2028.png 1.5x, /alphv/img/Untitled%2028.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2028.png"
        title="Untitled" width="676" height="64" /></p>
<p>The next thing it did was to prepare the ransom note file and the image. It dropped on the desktop first before any encryption. Then, while encrypting the files, it will be dropped in every directory.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2029.png"
        data-srcset="/alphv/img/Untitled%2029.png, /alphv/img/Untitled%2029.png 1.5x, /alphv/img/Untitled%2029.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2029.png"
        title="Untitled" width="1402" height="411" /></p>
<h3 id="encryption-mechanism">Encryption Mechanism</h3>
<p>The malware then looks for a specific locations like previous search queries in <code>C:\Users\&lt;USER&gt;\Searches\Everywhere.search-ms</code>  and drops the malware note there too (before encrypting).</p>
<p>it makes three files in the search directory:</p>
<ul>
<li>The ransom note.</li>
<li><code>checkpoints-Everywhere.search-ms.kh1ftzx</code> that contain a number.</li>
<li><code>Everywhere.search-ms.kh1ftzx</code> that will be encrypted.</li>
</ul>
<p>The malware then prepares a configuration data that describes the file being encrypted and it includes encryption mode, the encryption algorithm (chacha20 and AES) and the private key ….</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;version&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;mode&#34;</span><span class="p">:</span><span class="s2">&#34;Full&#34;</span><span class="p">,</span><span class="nt">&#34;cipher&#34;</span><span class="p">:</span><span class="s2">&#34;Aes&#34;</span><span class="p">,</span><span class="nt">&#34;private_key&#34;</span><span class="p">:[</span><span class="mi">86</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">83</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">227</span><span class="p">,</span><span class="mi">184</span><span class="p">,</span><span class="mi">242</span><span class="p">,</span><span class="mi">209</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span><span class="mi">235</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">117</span><span class="p">],</span><span class="nt">&#34;data_size&#34;</span><span class="p">:</span><span class="mi">248</span><span class="p">,</span><span class="nt">&#34;chunk_size&#34;</span><span class="p">:</span><span class="mi">25362816</span><span class="p">,</span><span class="nt">&#34;finished&#34;</span><span class="p">:</span><span class="kc">false</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The Encryption algorithm used is AES. The previous one was for <code>Everywhere.search-ms.kh1ftzx</code>. and the key is randomly generated. The JSON data are used to represent the file and its generated key.</p>
<p>The encryption process starts with adjusting the file pointer to the beginning of the file using <code>SetFilePointerEx</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2030.png"
        data-srcset="/alphv/img/Untitled%2030.png, /alphv/img/Untitled%2030.png 1.5x, /alphv/img/Untitled%2030.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2030.png"
        title="Untitled" width="1234" height="113" /></p>
<p>Then, it uses <code>WriteFile</code> to over-write the content. The writing is by appending data (4-bytes then a bigger chunk then the first 4-bytes again) to the end of the file and repeat the process</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2031.png"
        data-srcset="/alphv/img/Untitled%2031.png, /alphv/img/Untitled%2031.png 1.5x, /alphv/img/Untitled%2031.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2031.png"
        title="Untitled" width="634" height="568" /></p>
<p>This picture shows the original data (First 0xF8 bytes) delimited by 4-bytes followed by RSA encrypted data (0x100) that contain the JSON data -with AES key- and 4-bytes (00 00 01 00) that was copied before the encrypted text followed by the same 4-bytes delimiter. the first bytes would be then encrypted using AES and the random generated key.</p>
<p>The malware then get a handle to multiple files and read the first 4-bytes of the data. It goes through all the folder under <code>C:\users\&lt;user&gt;</code> and repeat the process. This is done first to the USER directory. Then it uses some Win32 API <code>GetLogicalDrives</code> to get all the available disk drives.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2032.png"
        data-srcset="/alphv/img/Untitled%2032.png, /alphv/img/Untitled%2032.png 1.5x, /alphv/img/Untitled%2032.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2032.png"
        title="Untitled" width="303" height="124" /></p>
<p>Then, it goes through all the drives using <code>FindFirstVolumeW</code> <strong>and</strong> <code>FindNextVolumeW</code> . The malware has a list of all the Drive letters. here is a small snippet.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2033.png"
        data-srcset="/alphv/img/Untitled%2033.png, /alphv/img/Untitled%2033.png 1.5x, /alphv/img/Untitled%2033.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2033.png"
        title="Untitled" width="793" height="555" /></p>
<p>for the found drive, it then uses <code>GetVolumePathNameW</code> to get the path to the mount point of the drive. If there is no path to it, it mount it to the system to encrypt it.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2034.png"
        data-srcset="/alphv/img/Untitled%2034.png, /alphv/img/Untitled%2034.png 1.5x, /alphv/img/Untitled%2034.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2034.png"
        title="Untitled" width="675" height="99" /></p>
<p>And for every directory, it uses <code>FindFirstFileW</code> and <code>FindNextFileW</code> to get all the files.</p>
<p>The encryption process described for <code>Everywhere.search-ms</code> is applied for all files. It first create a file with the original file name and <code>checkpoint</code> added to the beginning and the ransomware extension. Then, it generates an AES key to be used to encrypt the file and add it to the JSON data. The JSON data is then encrypted using RSA public key provided in the sample data. The RSA encrypted data are delimited by 4-bytes value = 19 47 B3 01. The original file data is then encrypted using AES cipher and the encrypted data is written back.</p>
<p>There are some exclusion paths and file extensions that will not be encrypted. these exclusions are defined in the configurations of the Ransomware.</p>
<p>Example of encrypted file containing the mentioned elements:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2035.png"
        data-srcset="/alphv/img/Untitled%2035.png, /alphv/img/Untitled%2035.png 1.5x, /alphv/img/Untitled%2035.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2035.png"
        title="Untitled" width="659" height="412" /></p>
<p>The last thing is to drop on the desktop background:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/RECOVER-kh1ftzx-FILES.txt.png"
        data-srcset="/alphv/img/RECOVER-kh1ftzx-FILES.txt.png, /alphv/img/RECOVER-kh1ftzx-FILES.txt.png 1.5x, /alphv/img/RECOVER-kh1ftzx-FILES.txt.png 2x"
        data-sizes="auto"
        alt="/alphv/img/RECOVER-kh1ftzx-FILES.txt.png"
        title="RECOVER-kh1ftzx-FILES.txt.png" width="1024" height="42" /></p>
<h2 id="config-extractor">Config Extractor</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">yara</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">rule alphv_blackcat_config_extractor{
</span></span></span><span class="line"><span class="cl"><span class="s1">    strings:
</span></span></span><span class="line"><span class="cl"><span class="s1">        $a1 = {7b 22 63 6f 6e 66 69 67 5f 69 64 22} // {&#34;config_id&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">    condition:
</span></span></span><span class="line"><span class="cl"><span class="s1">        $a1
</span></span></span><span class="line"><span class="cl"><span class="s1">}
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">end_rule</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">rule end_delimiter{
</span></span></span><span class="line"><span class="cl"><span class="s1">    strings:
</span></span></span><span class="line"><span class="cl"><span class="s1">        $a1 = {7D 20 20 20 20 20} // }</span><span class="se">\x20\x20\x20\x20\x20</span><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    condition:
</span></span></span><span class="line"><span class="cl"><span class="s1">        $a1
</span></span></span><span class="line"><span class="cl"><span class="s1">}
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_config</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config_json</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Config:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">config_json</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid JSON. Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Config:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;ALPHV/Blackcat ransomware config extractor&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path to the PE file&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">        <span class="n">compiled_rule</span> <span class="o">=</span> <span class="n">yara</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">rule</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">matches</span> <span class="o">=</span> <span class="n">compiled_rule</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">start</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">compiled_end</span> <span class="o">=</span> <span class="n">yara</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">end_rule</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">matches_end</span> <span class="o">=</span> <span class="n">compiled_end</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">end_match</span> <span class="ow">in</span> <span class="n">matches_end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strings</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># print(start)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># print(end_match[0])</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">end_match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># print(end_match[0])</span>
</span></span><span class="line"><span class="cl">                <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">,</span><span class="n">start</span><span class="p">,</span> <span class="n">end_match</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="n">print_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No matches found&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Usage:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/Untitled%2036.png"
        data-srcset="/alphv/img/Untitled%2036.png, /alphv/img/Untitled%2036.png 1.5x, /alphv/img/Untitled%2036.png 2x"
        data-sizes="auto"
        alt="/alphv/img/Untitled%2036.png"
        title="Untitled" width="1078" height="492" /></p>
<h2 id="yara">YARA</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">rule</span> <span class="n">ALPHV_BlackCat_Ransomware</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">malware</span> <span class="o">=</span> <span class="s2">&#34;ALPHV/BlackCat Ransomware&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">hash</span> <span class="o">=</span> <span class="s2">&#34;ecea6b772742758a2240898ef772ca11aa9d870aec711cffab8994c23044117c&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">author</span> <span class="o">=</span> <span class="s2">&#34;d01a&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;detect ALPHV/BlackCat Ransomware&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">strings</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv1</span> <span class="o">=</span> <span class="s2">&#34;No Access Token Provided&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv2</span> <span class="o">=</span> <span class="s2">&#34;locker::core::os::windows&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv3</span> <span class="o">=</span> <span class="s2">&#34;locker::core::pipeline&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv4</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="se">\\\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">pipe</span><span class="se">\\</span><span class="s2">__rust_anonymous_pipe1__.&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv5</span> <span class="o">=</span> <span class="s2">&#34;src/bin/encrypt_app/app.rs&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv6</span> <span class="o">=</span> <span class="s2">&#34;src/core/os/windows/privilege_escalation.rs&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv7</span> <span class="o">=</span> <span class="s2">&#34;rc/bin/encrypt_app/windows.rs&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv8</span> <span class="o">=</span> <span class="s2">&#34;{3E5FC7F9-9A51-4367-9063-A120244FBEC7}&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv9</span> <span class="o">=</span> <span class="s2">&#34;bcdedit /set </span><span class="si">{default}</span><span class="s2"> recoveryenabled No&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv10</span> <span class="o">=</span> <span class="s2">&#34;vssadmin.exe Delete Shadows /all /quiet&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv11</span> <span class="o">=</span> <span class="s2">&#34;wmic.exe Shadowcopy Delete&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">        <span class="err">$</span><span class="n">alphv12</span> <span class="o">=</span> <span class="s2">&#34;wmic csproduct get UUID&#34;</span> <span class="n">ascii</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">condition</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">uint16</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x5A4D</span>
</span></span><span class="line"><span class="cl">        <span class="ow">and</span> <span class="p">(</span><span class="n">uint32</span><span class="p">(</span><span class="n">uint32</span><span class="p">(</span><span class="mh">0x3C</span><span class="p">))</span> <span class="o">==</span> <span class="mh">0x00004550</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="ow">and</span> <span class="mi">7</span> <span class="n">of</span> <span class="n">them</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Hybrid-analysis search result <a href="https://www.hybrid-analysis.com/yara-search/results/c2410a8ac36941bc25515b194f0a4efbd79739faaf4bd8bb77c232b0ffbea905" target="_blank" rel="noopener noreffer ">Free Automated Malware Analysis Service - powered by Falcon Sandbox - Search results from HA Community Files (hybrid-analysis.com)</a></p>
<h2 id="iocs">IOCs</h2>
<table>
<thead>
<tr>
<th>IOC</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ecea6b772742758a2240898ef772ca11aa9d870aec711cffab8994c23044117c</td>
<td>ALPHV sha256 checksum</td>
</tr>
<tr>
<td>wmic csproduct get UUID</td>
<td>WMIC command</td>
</tr>
<tr>
<td>vssadmin.exe Delete Shadows /all /quiet</td>
<td>command to delete shadow copies</td>
</tr>
<tr>
<td>wmic.exe Shadowcopy Delete</td>
<td>command to delete shadow copies</td>
</tr>
<tr>
<td>bcdedit /set {default}</td>
<td>wrong command used</td>
</tr>
<tr>
<td>bcdedit /set {default} recoveryenabled No</td>
<td>command to disable recovery</td>
</tr>
<tr>
<td>cmd.exe /c  for /F &quot;tokens=*&quot; %1 in (&lsquo;wevtutil.exe el&rsquo;) DO wevtutil.exe cl &quot;%1&quot;</td>
<td>CMD loop to delete event logs</td>
</tr>
<tr>
<td>fsutil behavior set SymlinkEvaluation R2R:1</td>
<td>change filesystem symbolic links</td>
</tr>
<tr>
<td>fsutil behavior set SymlinkEvaluation R2L:1</td>
<td>change filesystem symbolic links</td>
</tr>
<tr>
<td>iisreset.exe /stop</td>
<td>command to reset IIS service</td>
</tr>
<tr>
<td>arp -a</td>
<td>command to get the ARP table</td>
</tr>
<tr>
<td>\.\pipe\rust_anonymous_pipe1.<PID>.<RandomValue></td>
<td>named piped schema used</td>
</tr>
<tr>
<td>\?\nul</td>
<td>virtual file used</td>
</tr>
<tr>
<td>{3E5FC7F9-9A51-4367-9063-A120244FBEC7}</td>
<td>CLSID used to bypass UAC</td>
</tr>
<tr>
<td>reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters /v MaxMpxCt /d 65535 /t REG_DWORD /f</td>
<td>command to edit lanman server speed</td>
</tr>
<tr>
<td>SOFTWARE\Microsoft\Cryptography\MachineGuid</td>
<td>quired registry key</td>
</tr>
<tr>
<td>checkpoints-&lt;Original_Filename&gt;.kh1ftzx</td>
<td>ransomware-created file</td>
</tr>
<tr>
<td>RECOVER-kh1ftzx-FILES.txt.png</td>
<td>ransom note wallpaper</td>
</tr>
<tr>
<td>RECOVER-kh1ftzx-FILES.txt</td>
<td>the ransom notes</td>
</tr>
<tr>
<td>src/bin/encrypt_app/app.rs</td>
<td>malware source code file name</td>
</tr>
<tr>
<td>src/core/os/windows/privilege_escalation.rs</td>
<td>malware source code file name</td>
</tr>
<tr>
<td>src/core/os/windows/samba.rs</td>
<td>malware source code file name</td>
</tr>
<tr>
<td>src/core/os/windows/system_info.rs</td>
<td>malware source code file name</td>
</tr>
<tr>
<td>rc/bin/encrypt_app/windows.rs</td>
<td>malware source code file name</td>
</tr>
</tbody>
</table>
<h2 id="mitre-attck">MITRE ATT&amp;CK</h2>
<table>
<thead>
<tr>
<th>Execution</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1059/003" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1059/003</a></td>
<td>Command and Scripting Interpreter: Windows Command Shell</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1047/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1047/</a></td>
<td>Windows Management Instrumentation</td>
</tr>
<tr>
<td>Privilege Escalation</td>
<td></td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1548/002/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1548/002/</a></td>
<td>Abuse Elevation Control Mechanism: Bypass User Account Control</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1055/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1055/</a></td>
<td>Process Injection</td>
</tr>
<tr>
<td>Defense Evasion</td>
<td></td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1548/002/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1548/002/</a></td>
<td>Abuse Elevation Control Mechanism: Bypass User Account Control</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1222/001/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1222/001/</a></td>
<td>File and Directory Permissions Modification: Windows File and Directory Permissions Modification</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1112/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1112/</a></td>
<td>Modify Registry</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1562/001/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1562/001/</a></td>
<td>Impair Defenses: Disable or Modify Tools</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1070/001/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1070/001/</a></td>
<td>Indicator Removal: Clear Windows Event Logs</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1070/004/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1070/004/</a></td>
<td>Indicator Removal: File Deletion</td>
</tr>
<tr>
<td>Discovery</td>
<td></td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1083" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1083</a></td>
<td>File and Directory Discovery</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1135/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1135/</a></td>
<td>Network Share Discovery</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1069/002/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1069/002/</a></td>
<td>Permission Groups Discovery: Domain Groups</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1057/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1057/</a></td>
<td>Process Discovery</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1018/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1018/</a></td>
<td>Remote System Discovery</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1033/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1033/</a></td>
<td>System Owner/User Discovery</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1007/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1007/</a></td>
<td>System Service Discovery</td>
</tr>
<tr>
<td>Impact</td>
<td></td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1485/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1485/</a></td>
<td>Data Destruction</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1486/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1486/</a></td>
<td>Data Encrypted for Impact</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1490/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1490/</a></td>
<td>Inhibit System Recovery</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1489/" target="_blank" rel="noopener noreffer ">https://attack.mitre.org/techniques/T1489/</a></td>
<td>Service Stop</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/alphv/img/ALPHV_Ransomware.png"
        data-srcset="/alphv/img/ALPHV_Ransomware.png, /alphv/img/ALPHV_Ransomware.png 1.5x, /alphv/img/ALPHV_Ransomware.png 2x"
        data-sizes="auto"
        alt="/alphv/img/ALPHV_Ransomware.png"
        title="ALPHV_Ransomware.png" width="1056" height="816" /></p>
<h2 id="references">References</h2>
<p><a href="https://research.checkpoint.com/2023/rust-binary-analysis-feature-by-feature/" target="_blank" rel="noopener noreffer ">https://research.checkpoint.com/2023/rust-binary-analysis-feature-by-feature/</a></p>
<p><a href="https://www.youtube.com/watch?v=q8irLfXwaFM" target="_blank" rel="noopener noreffer ">https://www.youtube.com/watch?v=q8irLfXwaFM</a></p>
<p><a href="https://ss64.com/nt/fsutil.html" target="_blank" rel="noopener noreffer ">https://ss64.com/nt/fsutil.html</a></p>
<p><a href="https://securityscorecard.com/research/deep-dive-into-alphv-blackcat-ransomware/" target="_blank" rel="noopener noreffer ">https://securityscorecard.com/research/deep-dive-into-alphv-blackcat-ransomware/</a></p>
<p><a href="https://www.sentinelone.com/labs/blackcat-ransomware-highly-configurable-rust-driven-raas-on-the-prowl-for-victims/" target="_blank" rel="noopener noreffer ">https://www.sentinelone.com/labs/blackcat-ransomware-highly-configurable-rust-driven-raas-on-the-prowl-for-victims/</a></p>
<p><a href="https://news.sophos.com/en-us/2020/04/24/lockbit-ransomware-borrows-tricks-to-keep-up-with-revil-and-maze/" target="_blank" rel="noopener noreffer ">https://news.sophos.com/en-us/2020/04/24/lockbit-ransomware-borrows-tricks-to-keep-up-with-revil-and-maze/</a></p>
<p><a href="https://www.exploit-db.com/exploits/41607" target="_blank" rel="noopener noreffer ">Microsoft Windows - COM Session Moniker Privilege Escalation (MS17-012) - Windows local Exploit (exploit-db.com)</a></p>
<p><a href="https://www.microsoft.com/en-us/security/blog/2022/06/13/the-many-lives-of-blackcat-ransomware/" target="_blank" rel="noopener noreffer ">The many lives of BlackCat ransomware | Microsoft Security Blog</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-05-30&nbsp;<a class="git-hash" href="https://github.com/dillonzq/LoveIt/commit/854da8a957ed7e9d539b5c037d678f38f9b66b35" target="_blank" title="commit by mohamedadel46(muhammed195826@feng.bu.edu.eg) 854da8a957ed7e9d539b5c037d678f38f9b66b35: Added: some old reports">
                                    <i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>854da8a</a></span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/alphv/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://d01a.github.io/alphv/" data-title="ALPHV ransomware" data-via="0xd01a" data-hashtags="Malware Analysis,Reverse Engineering"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://d01a.github.io/alphv/" data-hashtag="Malware Analysis"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://d01a.github.io/alphv/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://d01a.github.io/alphv/" data-title="ALPHV ransomware"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://d01a.github.io/alphv/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://d01a.github.io/alphv/" data-title="ALPHV ransomware"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://d01a.github.io/alphv/" data-title="ALPHV ransomware"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Trello" data-sharer="trello" data-url="https://d01a.github.io/alphv/" data-title="ALPHV ransomware" data-description="ALPHV ransomware analysis"><i class="fab fa-trello fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/malware-analysis/">Malware Analysis</a>,&nbsp;<a href="/tags/reverse-engineering/">Reverse Engineering</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/redline/" class="prev" rel="prev" title="Redline stealer"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Redline stealer</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.102.3">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Mohamed Adel</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightgallery":true};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
